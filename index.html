<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“¡å·¥å‡ç®¡ç†ç³»çµ±-1</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons çµ„ä»¶
        const Users = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const Calendar = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const FileText = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
        );

        const Clock = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const Clipboard = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
        );

        const LogOut = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Edit2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Bell = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
        );

        const regionOptions = ['æ–°ç«¹å€', 'å°ä¸­å€', 'å˜‰ç¾©å€'];
        const departmentOptions = ['ç®¡ç†éƒ¨', 'TSE', 'FAE', 'æ–°å ´', 'å€‰ç®¡', 'RD', 'ç·šä¸Šå®¢æœ'];

        const firebaseConfig = {
            apiKey: 'AIzaSyDlckNcNvIBOOEO23gHlt7A-H13mUelYqM',
            authDomain: 'goldbricks-38d0a.firebaseapp.com',
            projectId: 'goldbricks-38d0a',
            storageBucket: 'goldbricks-38d0a.firebasestorage.app',
            messagingSenderId: '14002577439',
            appId: '1:14002577439:web:be07d91cab555954afb52a',
            measurementId: 'G-YY69T47198'
        };

        const isFirebaseConfigured = !Object.values(firebaseConfig).some(value => value.includes('è«‹æ”¹æˆä½ çš„ Firebase'));
        // Firebase é€£ç·šä½ç½®ï¼š
        // 1) SDK æœƒé€£åˆ° firebaseConfig.authDomain å°æ‡‰å°ˆæ¡ˆçš„ Firebase Authentication
        // 2) æ–°å¢å“¡å·¥å¸³è™Ÿæ™‚æœƒå‘¼å« Google Identity Toolkit REST API
        const firebaseApp = isFirebaseConfigured ? firebase.initializeApp(firebaseConfig) : null;
        const firebaseAuth = firebaseApp ? firebase.auth() : null;
        const firebaseSignupEndpoint = `https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${firebaseConfig.apiKey}`;

        // åˆå§‹åŒ–è³‡æ–™
        const initialData = {
            users: [
                {
                    id: 'E001',
                    username: '001',
                    name: 'ç®¡ç†å“¡',
                    region: 'æ–°ç«¹å€',
                    department: 'ç®¡ç†éƒ¨',
                    position: 'ç¶“ç†',
                    email: 'admin@company.com',
                    phone: '0912-345-678',
                    birthday: '1980-01-01',
                    shift: ['æ—©'],
                    isAdmin: true,
                    permissionRegions: [...regionOptions],
                    permissionDepartments: [...departmentOptions],
                    annualLeave: 14,
                    usedAnnualLeave: 0
                },
                {
                    id: 'E002',
                    username: '002',
                    name: 'ç‹å°æ˜',
                    region: 'å°ä¸­å€',
                    department: 'TSE',
                    position: 'å°ˆå“¡',
                    email: 'wang@company.com',
                    phone: '0923-456-789',
                    birthday: '1990-05-15',
                    shift: ['æ—©', 'æ™š'],
                    isAdmin: false,
                    permissionRegions: [],
                    permissionDepartments: [],
                    annualLeave: 10,
                    usedAnnualLeave: 2
                }
            ],
            leaves: [],
            schedules: [],
            auditLogs: [],
            vacationSettings: {
                openStart: '',
                openEnd: '',
                monthlyVacationDays: ''
            },
            vacationSchedule: {},
            vacationNotes: {}
        };

        // åœ‹å®šå‡æ—¥è³‡æ–™
        const holidays2026 = [
            { date: '2026-01-01', name: 'å…ƒæ—¦' },
            { date: '2026-02-15', name: 'å°å¹´å¤œ' },
            { date: '2026-02-16', name: 'é™¤å¤•' },
            { date: '2026-02-17', name: 'åˆä¸€' },
            { date: '2026-02-18', name: 'åˆäºŒ' },
            { date: '2026-02-19', name: 'åˆä¸‰' },
            { date: '2026-02-28', name: 'å’Œå¹³ç´€å¿µ' },
            { date: '2026-04-04', name: 'å…’ç«¥ ç¯€' },
            { date: '2026-04-05', name: 'æ¸…æ˜ ç¯€' },
            { date: '2026-05-01', name: 'å‹å‹• ç¯€' },
            { date: '2026-06-25', name: 'ç«¯åˆ ç¯€' },
            { date: '2026-09-28', name: 'æ•™å¸« ç¯€' },
            { date: '2026-10-01', name: 'ä¸­ç§‹ ç¯€' },
            { date: '2026-10-10', name: 'åœ‹æ…¶ æ—¥' },
            { date: '2026-10-25', name: 'å…‰å¾© ç¯€' },
            { date: '2026-12-25', name: 'è¡Œæ†²ç´€å¿µ' }
        ];

        const CURRENT_USER_STORAGE_KEY = 'leaveSystemCurrentUserId';

        const EmployeeLeaveSystem = () => {
             const [currentUser, setCurrentUser] = useState(() => {
                const savedData = localStorage.getItem('leaveSystemData');
                const savedUserId = localStorage.getItem(CURRENT_USER_STORAGE_KEY);

                if (!savedData || !savedUserId) return null;

                try {
                    const parsed = JSON.parse(savedData);
                    return (parsed.users || []).find(user => user.id === savedUserId) || null;
                } catch (error) {
                    return null;
                }
            });
            const [activeTab, setActiveTab] = useState('vacation');
            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('leaveSystemData');
                     if (!saved) return initialData;
                const parsed = JSON.parse(saved);
                return {
                    ...initialData,
                    ...parsed,
                    vacationSettings: {
                        ...initialData.vacationSettings,
                        ...parsed.vacationSettings
                    },
                    schedules: parsed.schedules || [],
                    vacationSchedule: parsed.vacationSchedule || {},
                    vacationNotes: parsed.vacationNotes || {}
                };
            });

            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [authReady, setAuthReady] = useState(false);
            const [selectedMonth, setSelectedMonth] = useState(new Date(2026, 1)); // 2æœˆ
            const [filterRegion, setFilterRegion] = useState('å…¨éƒ¨');
            const [filterDepartment, setFilterDepartment] = useState('å…¨éƒ¨');
            const [filterShift, setFilterShift] = useState('å…¨éƒ¨');
            const [selectedAnnualUserId, setSelectedAnnualUserId] = useState('');
            const [selectedVacationMarker, setSelectedVacationMarker] = useState('â–²-black');
            const [showVacationSettings, setShowVacationSettings] = useState(false);
            const [newLeaveForm, setNewLeaveForm] = useState({
                type: 'ç‰¹ä¼‘',
                startDate: '',
                endDate: '',
                reason: '',
                hours: 8
            });
            const [showScheduleModal, setShowScheduleModal] = useState(false);
            const [selectedScheduleDate, setSelectedScheduleDate] = useState('');
            const [scheduleForm, setScheduleForm] = useState({ title: '', content: '' });

            const [showAddUser, setShowAddUser] = useState(false);
            const [editingUser, setEditingUser] = useState(null);
            const [newUserForm, setNewUserForm] = useState({
                id: '',
                username: '',
                firebasePassword: '',
                name: '',
                region: regionOptions[0],
                department: departmentOptions[0],
                position: 'å°ˆå“¡',
                email: '',
                phone: '',
                birthday: '',
                shift: [],
                annualLeave: 10,
                isAdmin: false,
                permissionRegions: [...regionOptions],
                permissionDepartments: [...departmentOptions]
            });

            useEffect(() => {
                localStorage.setItem('leaveSystemData', JSON.stringify(data));
            }, [data]);

            useEffect(() => {
                if (currentUser?.id) {
                    localStorage.setItem(CURRENT_USER_STORAGE_KEY, currentUser.id);
                } else {
                    localStorage.removeItem(CURRENT_USER_STORAGE_KEY);
                }
            }, [currentUser]);

            useEffect(() => {
                if (!currentUser?.id) return;

                const latestUser = data.users.find(user => user.id === currentUser.id);
                if (!latestUser) {
                    setCurrentUser(null);
                    setActiveTab('vacation');
                    return;
                }

                if (JSON.stringify(latestUser) !== JSON.stringify(currentUser)) {
                    setCurrentUser(latestUser);
                }
            }, [data.users, currentUser]);

            useEffect(() => {
                if (!firebaseAuth) {
                    setAuthReady(true);
                    return;
                }

                const unsubscribe = firebaseAuth.onAuthStateChanged((authUser) => {
                    if (!authUser) {
                        setCurrentUser(null);
                        setAuthReady(true);
                        return;
                    }

                    const matchedUser = data.users.find(user => user.email === authUser.email);
                    if (matchedUser) {
                        setCurrentUser(matchedUser);
                    } else {
                        alert('Firebase å·²ç™»å…¥,ä½†ç³»çµ±å…§æ‰¾ä¸åˆ°å°æ‡‰å“¡å·¥è³‡æ–™');
                        firebaseAuth.signOut();
                    }
                    setAuthReady(true);
                });

                return () => unsubscribe();
            }, [data.users]);

            const createFirebaseAccount = async (email, password) => {
                const response = await fetch(firebaseSignupEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, returnSecureToken: false })
                });

                const result = await response.json();
                if (!response.ok) {
                    const message = result?.error?.message || 'Firebase å»ºç«‹å¸³è™Ÿå¤±æ•—';
                    throw new Error(message);
                }

                return result;
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                 if (!isFirebaseConfigured || !firebaseAuth) {
                    alert('è«‹å…ˆåœ¨ç¨‹å¼ç¢¼å…§è¨­å®š Firebase config');
                    return;
                }

                const user = data.users.find(u => u.username === loginForm.username);
                if (!user?.email) {
                    alert('æ‰¾ä¸åˆ°æ­¤å¸³è™Ÿ,æˆ–è©²å“¡å·¥æœªè¨­å®š Email');
                    return;
                }

                try {
                    await firebaseAuth.signInWithEmailAndPassword(user.email, loginForm.password);
                    setLoginForm({ username: '', password: '' });
                } catch (error) {
                    alert(`ç™»å…¥å¤±æ•—: ${error.message}`);
                }
            };

             const handleQuickAdminEntry = () => {
                const adminUser = data.users.find(user => user.isAdmin) || data.users[0];
                if (!adminUser) {
                    alert('ç›®å‰æ²’æœ‰å¯ç™»å…¥çš„å“¡å·¥è³‡æ–™');
                    return;
                }

                setCurrentUser(adminUser);
                setLoginForm({ username: '', password: '' });
            };
            
            const handleLogout = async () => {
                if (firebaseAuth) {
                    await firebaseAuth.signOut();
                }
                setCurrentUser(null);
            };

            const handleDeleteUser = (userId) => {
                const user = data.users.find(u => u.id === userId);
                if (!user || !canManageUser(user)) {
                    alert('ç„¡æ¬Šé™åˆªé™¤æ­¤å“¡å·¥');
                    return;
                }
                if (window.confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å“¡å·¥å—?')) {
                    setData(prev => ({
                        ...prev,
                        users: prev.users.filter(u => u.id !== userId),
                        auditLogs: [...prev.auditLogs, {
                            timestamp: new Date().toISOString(),
                            user: currentUser.name,
                            action: 'åˆªé™¤å“¡å·¥',
                            details: user.name
                        }]
                    }));
                }
            };

            const handleEditUser = (user) => {
                if (!canManageUser(user)) {
                    alert('ç„¡æ¬Šé™ç·¨è¼¯æ­¤å“¡å·¥è³‡æ–™');
                    return;
                }
                setEditingUser(user);
                setNewUserForm({
                    id: user.id,
                    username: user.username,
                    firebasePassword: '',
                    name: user.name,
                    region: user.region,
                    department: user.department,
                    position: user.position,
                    email: user.email,
                    phone: user.phone,
                    birthday: user.birthday,
                    shift: user.shift,
                    annualLeave: user.annualLeave,
                    isAdmin: user.isAdmin || false,
                    permissionRegions: Array.isArray(user.permissionRegions) ? user.permissionRegions : [...regionOptions],
                    permissionDepartments: Array.isArray(user.permissionDepartments) ? user.permissionDepartments : [...departmentOptions]
                });
                setShowAddUser(true);
            };

            const handleAddUser = async (e) => {
                e.preventDefault();

                const { firebasePassword, ...userPayload } = newUserForm;
                
                if (editingUser) {
                    // ç·¨è¼¯æ¨¡å¼
                    setData(prev => ({
                       ...prev,
                       users: prev.users.map(u =>
                            u.id === editingUser.id
                                ? { ...userPayload, usedAnnualLeave: u.usedAnnualLeave }
                                : u
                        ),
                        auditLogs: [...prev.auditLogs, {
                            timestamp: new Date().toISOString(),
                            user: currentUser.name,
                            action: 'ç·¨è¼¯å“¡å·¥',
                            details: `${newUserForm.id} - ${newUserForm.name}`
                        }]
                    }));
                    alert('å“¡å·¥è³‡æ–™æ›´æ–°æˆåŠŸ!');
                } else {
                    // æ–°å¢æ¨¡å¼
                    // æª¢æŸ¥å“¡å·¥ä»£è™Ÿæ˜¯å¦å·²å­˜åœ¨
                    if (data.users.find(u => u.id === newUserForm.id)) {
                        alert('å“¡å·¥ä»£è™Ÿå·²å­˜åœ¨,è«‹ä½¿ç”¨å…¶ä»–ä»£è™Ÿ!');
                        return;
                    }

                    // æª¢æŸ¥å¸³è™Ÿæ˜¯å¦å·²å­˜åœ¨
                    if (data.users.find(u => u.username === newUserForm.username)) {
                        alert('å¸³è™Ÿå·²å­˜åœ¨,è«‹ä½¿ç”¨å…¶ä»–å¸³è™Ÿ!');
                        return;
                    }

                    if (data.users.find(u => u.email === newUserForm.email)) {
                        alert('Email å·²å­˜åœ¨,è«‹ä½¿ç”¨å…¶ä»– Email!');
                        return;
                    }

                    if (!firebasePassword || firebasePassword.length < 6) {
                        alert('Firebase å¯†ç¢¼è‡³å°‘è¦ 6 ç¢¼!');
                        return;
                    }

                    if (!isFirebaseConfigured || !firebaseAuth) {
                        alert('è«‹å…ˆåœ¨ç¨‹å¼ç¢¼å…§è¨­å®š Firebase config');
                        return;
                    }

                    try {
                        await createFirebaseAccount(newUserForm.email, firebasePassword);
                    } catch (error) {
                        alert(`Firebase å¸³è™Ÿå»ºç«‹å¤±æ•—: ${error.message}`);
                        return;
                    }

                    const newUser = {
                        ...userPayload,
                        usedAnnualLeave: 0
                    };

                    setData(prev => ({
                         ...prev,
                         users: [...prev.users, newUser],
                        auditLogs: [...prev.auditLogs, {
                            timestamp: new Date().toISOString(),
                            user: currentUser.name,
                            action: 'æ–°å¢å“¡å·¥',
                            details: `${newUser.id} - ${newUser.name}`
                        }]
                    }));
                    alert('å“¡å·¥æ–°å¢æˆåŠŸ!');
                }

                setNewUserForm({
                    id: '',
                    username: '',
                    firebasePassword: '',
                    name: '',
                    region: regionOptions[0],
                    department: departmentOptions[0],
                    position: 'å°ˆå“¡',
                    email: '',
                    phone: '',
                    birthday: '',
                    shift: [],
                    annualLeave: 10,
                    isAdmin: false,
                    permissionRegions: [...regionOptions],
                    permissionDepartments: [...departmentOptions]
                });

                setShowAddUser(false);
                setEditingUser(null);
            };

            const toggleShift = (shiftType) => {
                setNewUserForm(prev => ({
                    ...prev,
                    shift: prev.shift.includes(shiftType)
                        ? prev.shift.filter(s => s !== shiftType)
                        : [...prev.shift, shiftType]
                }));
            };

            const togglePermission = (type, value) => {
                setNewUserForm(prev => {
                    const key = type === 'region' ? 'permissionRegions' : 'permissionDepartments';
                    const current = prev[key] || [];
                    const next = current.includes(value)
                        ? current.filter(item => item !== value)
                        : [...current, value];
                    return { ...prev, [key]: next };
                });
            };

            const getEffectivePermissions = (permissions) =>
                Array.isArray(permissions) ? permissions : [];

            const canManageUser = (targetUser) => {
                if (!currentUser?.isAdmin) return false;
                const regionPermissions = getEffectivePermissions(currentUser.permissionRegions);
                const departmentPermissions = getEffectivePermissions(currentUser.permissionDepartments);
                return regionPermissions.includes(targetUser.region) || departmentPermissions.includes(targetUser.department);
            };

            const canApproveLeave = (leave) => {
                if (!currentUser?.isAdmin) return false;
                const regionPermissions = getEffectivePermissions(currentUser.permissionRegions);
                const departmentPermissions = getEffectivePermissions(currentUser.permissionDepartments);
                return regionPermissions.includes(leave.region) || departmentPermissions.includes(leave.department);
            };

            const pendingLeaves = data.leaves.filter(l => l.status === 'å¾…å¯©æ ¸');
            const approvablePendingLeaves = pendingLeaves.filter(leave => canApproveLeave(leave));

             const formatLocalDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const parseDateString = (dateStr) => {
                if (!dateStr) return null;
                const [year, month, day] = dateStr.split('-').map(Number);
                if (!year || !month || !day) return null;
                return new Date(year, month - 1, day);
            };
            
            const getCompStats = (userId, monthDate) => {
                const targetMonth = monthDate.getMonth();
                const targetYear = monthDate.getFullYear();
                const compHours = data.leaves.filter(l =>
                    l.userId === userId &&
                    l.type === 'è£œä¼‘(æ™‚)' &&
                    l.status === 'å·²æ ¸å‡†' &&
                    parseDateString(l.startDate)?.getMonth() === targetMonth &&
                    parseDateString(l.startDate)?.getFullYear() === targetYear
                );
                const compDays = data.leaves.filter(l =>
                    l.userId === userId &&
                    l.type === 'è£œä¼‘(å¤©)' &&
                    l.status === 'å·²æ ¸å‡†' &&
                    parseDateString(l.startDate)?.getMonth() === targetMonth &&
                    parseDateString(l.startDate)?.getFullYear() === targetYear
                );

                return {
                    hours: compHours.reduce((sum, l) => sum + (l.hours || 0), 0),
                    days: compDays.length
                };
            };

            const openScheduleModal = (dateStr) => {
                setSelectedScheduleDate(dateStr);
                setScheduleForm({ title: '', content: '' });
                setShowScheduleModal(true);
            };

            const handleScheduleSubmit = (e) => {
                e.preventDefault();
                if (!scheduleForm.title.trim() || !scheduleForm.content.trim()) {
                    alert('è«‹å¡«å¯«æ’ç¨‹æ¨™é¡Œèˆ‡å…§å®¹');
                    return;
                }

                setData(prev => ({
                    ...prev,
                    schedules: [
                        ...(prev.schedules || []),
                        {
                            id: Date.now().toString(),
                            date: selectedScheduleDate,
                            title: scheduleForm.title.trim(),
                            content: scheduleForm.content.trim()
                        }
                    ]
                }));

                setShowScheduleModal(false);
            };

            const handleDeleteSchedule = (scheduleId) => {
                if (!window.confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) return;

                setData(prev => ({
                    ...prev,
                    schedules: (prev.schedules || []).filter(schedule => schedule.id !== scheduleId)
                }));
            };

            const handleSubmitLeave = (e) => {
                e.preventDefault();
                const newLeave = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    userName: currentUser.name,
                    department: currentUser.department,
                    region: currentUser.region,
                    ...newLeaveForm,
                    status: 'å¾…å¯©æ ¸',
                    submittedAt: new Date().toISOString()
                };

                setData(prev => ({
                    ...prev,
                    leaves: [...prev.leaves, newLeave]
                }));

                setNewLeaveForm({
                    type: 'ç‰¹ä¼‘',
                    startDate: '',
                    endDate: '',
                    reason: '',
                    hours: 8
                });

                alert('è«‹å‡ç”³è«‹å·²é€å‡º');
            };

            const handleApproveLeave = (leaveId, status) => {
                const targetLeave = data.leaves.find(l => l.id === leaveId);
                if (!targetLeave || !canApproveLeave(targetLeave)) {
                    alert('ç„¡æ¬Šé™å¯©æ ¸æ­¤è«‹å‡ç”³è«‹');
                    return;
                }
                setData(prev => ({
                    ...prev,
                    leaves: prev.leaves.map(l =>
                        l.id === leaveId ? { ...l, status } : l
                    )
                }));
            };

            const exportToCSV = (type) => {
                let csv = '';
                let filename = '';
 
                if (type === 'users') {
                    csv = 'å“¡å·¥ä»£è™Ÿ,å§“å,åœ°å€,éƒ¨é–€,è·ç¨±,Email,é›»è©±,ç”Ÿæ—¥,ç­åˆ¥,ç¸½ç‰¹ä¼‘,å·²ä½¿ç”¨ç‰¹ä¼‘,å‰©é¤˜ç‰¹ä¼‘\n';
                    data.users.forEach(u => {
                        const usedLeave = data.leaves.filter(l => l.userId === u.id && l.type === 'ç‰¹ä¼‘' && l.status === 'å·²æ ¸å‡†').length;
                        csv += `${u.id},${u.name},${u.region},${u.department},${u.position},${u.email},${u.phone},${u.birthday},${u.shift.join('/')},${u.annualLeave},${usedLeave},${u.annualLeave - usedLeave}\n`;
                    });
                    filename = 'äººå“¡ç®¡ç†.csv';
                } else if (type === 'vacation') {
                    csv = 'å“¡å·¥ä»£è™Ÿ,å§“å,åœ°å€,éƒ¨é–€,ç­åˆ¥,';
                    const days = getMonthDays(selectedMonth);
                    days.forEach(day => {
                        csv += `${day.getMonth()+1}/${day.getDate()},`;
                    });
                    csv += 'ç¸½è«‹å‡å¤©æ•¸\n';

                    data.users.forEach(user => {
                        const userLeaves = data.leaves.filter(l => l.userId === user.id && l.status === 'å·²æ ¸å‡†');
                        csv += `${user.id},${user.name},${user.region},${user.department},${user.shift.join('/')},`;
                        days.forEach(day => {
                            const dateStr = formatLocalDate(day);
                            const leave = userLeaves.find(l => dateStr >= l.startDate && dateStr <= l.endDate);
                            csv += `${leave ? leave.type : ''},`;
                        });
                        csv += `${userLeaves.filter(l => parseDateString(l.startDate)?.getMonth() === selectedMonth.getMonth()).length}\n`;
                    });
                    filename = `ä¼‘å‡è¡¨_${selectedMonth.getFullYear()}å¹´${selectedMonth.getMonth()+1}æœˆ.csv`;
                } else if (type === 'compensatory') {
                    csv = 'å“¡å·¥ä»£è™Ÿ,å§“å,åœ°å€,éƒ¨é–€,è£œä¼‘(æ™‚)å·²ä½¿ç”¨,è£œä¼‘(å¤©)å·²ä½¿ç”¨\n';
                    data.users.forEach(u => {
                        const compHours = data.leaves.filter(l => l.userId === u.id && l.type === 'è£œä¼‘(æ™‚)' && l.status === 'å·²æ ¸å‡†');
                        const compDays = data.leaves.filter(l => l.userId === u.id && l.type === 'è£œä¼‘(å¤©)' && l.status === 'å·²æ ¸å‡†');
                        const totalHours = compHours.reduce((sum, l) => sum + (l.hours || 0), 0);
                        csv += `${u.id},${u.name},${u.region},${u.department},${totalHours},${compDays.length}\n`;
                    });
                    filename = 'è£œä¼‘è¡¨.csv';
                } else if (type === 'schedule') {
                    csv = 'æ—¥æœŸ,æ¨™é¡Œ,å…§å®¹\n';
                    if (data.schedules && data.schedules.length > 0) {
                        data.schedules.forEach(s => {
                            csv += `${s.date},${s.title || ''},${s.content || ''}\n`;
                        });
                    } else {
                        csv += 'ç›®å‰æ²’æœ‰æ’ç¨‹è³‡æ–™\n';
                    }
                    filename = 'æ’ç¨‹è¡¨.csv';
                } else if (type === 'leaves') {
                    csv = 'ç”³è«‹æ—¥æœŸ,å“¡å·¥ä»£è™Ÿ,å§“å,åœ°å€,éƒ¨é–€,å‡åˆ¥,é–‹å§‹æ—¥æœŸ,çµæŸæ—¥æœŸ,æ™‚æ•¸,äº‹ç”±,ç‹€æ…‹,å¯©æ ¸äºº,å¯©æ ¸æ™‚é–“\n';
                    data.leaves.forEach(l => {
                        const user = data.users.find(u => u.id === l.userId);
                        csv += `${new Date(l.submittedAt).toLocaleDateString('zh-TW')},${user?.id || ''},${l.userName},${l.region},${l.department},${l.type},${l.startDate},${l.endDate},${l.hours},${l.reason},${l.status},${l.approvedBy || ''},${l.approvedAt ? new Date(l.approvedAt).toLocaleDateString('zh-TW') : ''}\n`;
                    });
                    filename = 'è«‹å‡ç´€éŒ„.csv';
                } else if (type === 'annual') {
                    csv = 'å“¡å·¥ä»£è™Ÿ,å§“å,åœ°å€,éƒ¨é–€,è·ç¨±,ç¸½ç‰¹ä¼‘å¤©æ•¸,å·²ä½¿ç”¨å¤©æ•¸,å‰©é¤˜å¤©æ•¸,ä½¿ç”¨æ—¥æœŸæ˜ç´°\n';
                    data.users.forEach(u => {
                        const annualLeaves = data.leaves.filter(l => l.userId === u.id && l.type === 'ç‰¹ä¼‘' && l.status === 'å·²æ ¸å‡†');
                        const usedDays = annualLeaves.length;
                        const dates = annualLeaves.map(l => `${l.startDate}~${l.endDate}`).join('; ');
                        csv += `${u.id},${u.name},${u.region},${u.department},${u.position},${u.annualLeave},${usedDays},${u.annualLeave - usedDays},"${dates}"\n`;
                    });
                    filename = 'ç‰¹ä¼‘ç¸½è¦½.csv';
                }

                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
            };

            const getMonthDays = (date) => {
                const days = [];
                const year = date.getFullYear();
                const month = date.getMonth();
                const lastDay = new Date(year, month + 1, 0).getDate();

                for (let d = 1; d <= lastDay; d++) {
                    days.push(new Date(year, month, d));
                }
                return days;
            };

            const isHoliday = (date) => {
                const dateStr = formatLocalDate(date);
                return holidays2026.find(h => h.date === dateStr);
            };

            const isWeekend = (date) => {
                return date.getDay() === 0 || date.getDay() === 6;
            };

             const isWithinOpenRange = (date) => {
                const dateStr = formatLocalDate(date);
                const { openStart, openEnd } = data.vacationSettings;
                if (!openStart || !openEnd) return false;
                return dateStr >= openStart && dateStr <= openEnd;
            };

             const getDateRangeList = (startDate, endDate) => {
                if (!startDate || !endDate) return [];
                const cursor = new Date(startDate);
                const last = new Date(endDate);
                const dates = [];

                if (Number.isNaN(cursor.getTime()) || Number.isNaN(last.getTime())) return [];

                while (cursor <= last) {
                    dates.push(formatLocalDate(cursor));
                    cursor.setDate(cursor.getDate() + 1);
                }

                return dates;
            };

            const handleVacationSettingChange = (field, value) => {
                setData(prev => ({
                    ...prev,
                    vacationSettings: {
                        ...prev.vacationSettings,
                        [field]: value
                    }
                }));
            };

             const vacationMarkerOptions = [
                { value: 'â–²-black', label: 'â–² é»‘è‰²', symbol: 'â–²', textClass: 'text-gray-900', activeClass: 'border-gray-800 bg-gray-100' },
                { value: 'â–²-red', label: 'â–² ç´…è‰²', symbol: 'â–²', textClass: 'text-red-600', activeClass: 'border-red-500 bg-red-50' },
                { value: 'â˜…-black', label: 'â˜… é»‘è‰²', symbol: 'â˜…', textClass: 'text-gray-900', activeClass: 'border-gray-800 bg-gray-100' },
                { value: 'â˜…-red', label: 'â˜… ç´…è‰²', symbol: 'â˜…', textClass: 'text-red-600', activeClass: 'border-red-500 bg-red-50' }
            ];

            const getMarkerDisplay = (marker) => {
                if (!marker) return null;
                if (marker.includes('-')) {
                    const [symbol, color] = marker.split('-');
                    return {
                        symbol,
                        className: color === 'red' ? 'text-red-600 font-bold' : 'text-gray-900 font-bold'
                    };
                }
                if (marker === 'â˜…') {
                    return { symbol: 'â˜…', className: 'text-red-600 font-bold' };
                }
                return { symbol: marker, className: 'text-gray-900 font-bold' };
            };

            const handleToggleVacation = (userId, dateStr) => {
                if (!data.vacationSettings.openStart || !data.vacationSettings.openEnd) return;
                const isOpen = dateStr >= data.vacationSettings.openStart && dateStr <= data.vacationSettings.openEnd;
                if (!isOpen) return;
                if (currentUser.id !== userId) return;
                setData(prev => {
                    const userSchedule = prev.vacationSchedule[userId] || {};
                    const currentMarker = userSchedule[dateStr];
                    const nextMarker = currentMarker === selectedVacationMarker ? '' : selectedVacationMarker;
                    return {
                        ...prev,
                        vacationSchedule: {
                            ...prev.vacationSchedule,
                            [userId]: {
                                ...userSchedule,
                                [dateStr]: nextMarker
                            }
                        }
                    };
                });
            };

            const getWorkingCount = (date) => {
                const dateStr = formatLocalDate(date);
                const onLeave = data.leaves.filter(l =>
                    l.status === 'å·²æ ¸å‡†' &&
                    dateStr >= l.startDate &&
                    dateStr <= l.endDate
                ).length;
                return data.users.length - onLeave;
            };

             const getCompensatoryCellData = (userId, dateStr) => {
                const matchedLeaves = data.leaves.filter(l =>
                    l.userId === userId &&
                    l.status === 'å·²æ ¸å‡†' &&
                    (l.type === 'è£œä¼‘(æ™‚)' || l.type === 'è£œä¼‘(å¤©)') &&
                    dateStr >= l.startDate &&
                    dateStr <= l.endDate
                );

                if (matchedLeaves.length === 0) return null;

                const hasDayComp = matchedLeaves.some(l => l.type === 'è£œä¼‘(å¤©)');
                const totalHourComp = matchedLeaves
                    .filter(l => l.type === 'è£œä¼‘(æ™‚)')
                    .reduce((sum, leave) => sum + Number(leave.hours || 0), 0);

                if (hasDayComp && totalHourComp > 0) {
                    return `å¤©/${totalHourComp}h`;
                }

                if (hasDayComp) return 'è£œä¼‘å¤©';
                return `${totalHourComp}h`;
            };

            const handleResetData = () => {
                if (window.confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—?é€™å°‡æ¸…é™¤æ‰€æœ‰å“¡å·¥å’Œè«‹å‡ç´€éŒ„!')) {
                    localStorage.removeItem('leaveSystemData');
                    window.location.reload();
                }
            };

            if (!currentUser) {
                  if (!authReady) {
                    return <div className="min-h-screen flex items-center justify-center">Firebase é©—è­‰åˆå§‹åŒ–ä¸­...</div>;
                }

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4 text-base md:text-lg">
                        <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-lg">
                            <div className="text-center mb-8">
                                <div className="bg-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <Users size={32} className="text-white" />
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800">å“¡å·¥å‡å‹¤ç³»çµ±</h1>
                                <p className="text-gray-500 mt-2">è«‹ä½¿ç”¨å“¡å·¥å¸³è™Ÿ + Firebase å¯†ç¢¼ç™»å…¥</p>
                             </div>

                            <form onSubmit={handleLogin} className="space-y-4">
                                <div>
                                    <label className="block text-sm md:text-base font-medium text-gray-700 mb-2">å¸³è™Ÿ</label>
                                    <input
                                        type="text"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg"
                                        required
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm md:text-base font-medium text-gray-700 mb-2">å¯†ç¢¼</label>
                                    <input
                                        type="password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg"
                                        required
                                    />
                                </div>

                                <button type="submit" className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700">
                                    ç™»å…¥
                                </button>
                                
                                <button
                                    type="button"
                                    onClick={handleQuickAdminEntry}
                                    className="w-full bg-emerald-100 text-emerald-700 py-3 rounded-lg hover:bg-emerald-200"
                                >
                                    å¿«é€Ÿé€²å…¥ç³»çµ±ï¼ˆç®¡ç†å“¡ï¼‰
                                </button>
                            </form>

                          <div className="mt-6 p-4 bg-blue-50 rounded-lg text-sm md:text-base space-y-1">
                                <p className="font-medium">ç™»å…¥èªªæ˜:</p>
                                <p>1. è¼¸å…¥å“¡å·¥å¸³è™Ÿ (ä¾‹å¦‚ 001)</p>
                                <p>2. å¯†ç¢¼ç”± Firebase Authentication ç®¡ç†</p>
                                <p className="text-xs text-gray-600 pt-2">é€£ç·šç›®æ¨™: Firebase Authenticationï¼ˆ{firebaseConfig.projectId} / {firebaseConfig.authDomain}ï¼‰</p>
                                <p className="text-xs text-gray-600 break-all">å»ºç«‹å¸³è™Ÿ API: {firebaseSignupEndpoint}</p>
                            </div>

                            <div className="mt-4">
                               <button
                                    onClick={handleResetData}
                                    className="w-full px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 text-sm md:text-base"
                                >
                                    ğŸ”„ é‡ç½®ç³»çµ±è³‡æ–™
                                </button>
                                <p className="text-xs text-gray-500 text-center mt-2">
                                    å¦‚æœç„¡æ³•ç™»å…¥,è«‹é»æ“Šæ­¤æŒ‰éˆ•é‡ç½®
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 text-base md:text-lg">
                    <div className="fixed top-0 left-0 right-0 z-30 bg-white">
                    <nav className="bg-white shadow-sm border-b">
                     <div className="max-w-screen-2xl mx-auto px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center space-x-3">
                                    <div className="bg-indigo-600 w-10 h-10 rounded-lg flex items-center justify-center">
                                        <Users size={24} className="text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold">å“¡å·¥å‡å‹¤ç³»çµ±</h1>
                                       <p className="text-sm md:text-base text-gray-500">æ­¡è¿, {currentUser.name}</p>
                                    </div>
                                </div>

                                <div className="flex items-center space-x-4">
                                    <div className="text-right">
                                        <p className="text-sm md:text-base text-gray-600">å¯ä¼‘ç‰¹ä¼‘</p>
                                        <p className="text-lg font-bold text-indigo-600">
                                            {currentUser.annualLeave} å¤©
                                        </p>
                                    </div>
                                    <button onClick={handleLogout} className="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">
                                        ç™»å‡º
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <div className="bg-white border-b">
                        <div className="max-w-screen-2xl mx-auto px-4">
                            <div className="flex space-x-1">
                                {[
                                    { id: 'management', label: 'äººå“¡ç®¡ç†', icon: Users, admin: true },
                                    { id: 'vacation', label: 'ä¼‘å‡è¡¨', icon: Calendar },
                                    { id: 'compensatory', label: 'è£œä¼‘è¡¨', icon: Clock },
                                    { id: 'schedule', label: 'æ’ç¨‹è¡¨', icon: Clipboard },
                                    { id: 'leave', label: 'è«‹å‡', icon: FileText },
                                    { id: 'annual', label: 'ç‰¹ä¼‘', icon: Calendar }
                                ].map(tab => {
                                    if (tab.admin && !currentUser.isAdmin) return null;
                                    const Icon = tab.icon;
                                    return (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`flex items-center space-x-2 px-6 py-3 border-b-2 ${
                                                activeTab === tab.id ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-gray-600'
                                            }`}
                                        >
                                            <Icon size={18} />
                                            <span>{tab.label}</span>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                   </div>

                    <div className="max-w-screen-2xl mx-auto px-4 py-6 pt-40">
                        {activeTab === 'management' && currentUser.isAdmin && (
                            <div className="space-y-4">
                                <div className="flex justify-between">
                                    <h2 className="text-2xl font-bold">äººå“¡ç®¡ç†</h2>
                                    <div className="flex space-x-2">
                                       <button
                                            onClick={() => setShowAddUser(!showAddUser)}
                                            className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                        >
                                            {showAddUser ? 'å–æ¶ˆæ–°å¢' : '+ æ–°å¢å“¡å·¥'}
                                        </button>
                                        <button onClick={() => exportToCSV('users')} className="px-4 py-2 bg-green-600 text-white rounded-lg">
                                            åŒ¯å‡ºExcel
                                        </button>
                                    </div>
                                </div>

                                {showAddUser && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h3 className="text-lg font-bold mb-4">{editingUser ? 'ç·¨è¼¯å“¡å·¥' : 'æ–°å¢å“¡å·¥'}</h3>
                                        <form onSubmit={handleAddUser} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">å“¡å·¥ä»£è™Ÿ *</label>
                                                <input
                                                    type="text"
                                                    value={newUserForm.id}
                                                    onChange={(e) => setNewUserForm({...newUserForm, id: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder="ä¾‹å¦‚: E003"
                                                    disabled={editingUser}
                                                    required
                                                />
                                                <p className="text-xs text-gray-500 mt-1">è«‹è¼¸å…¥å”¯ä¸€çš„å“¡å·¥ä»£è™Ÿ</p>
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">å¸³è™Ÿ *</label>
                                                <input
                                                    type="text"
                                                    value={newUserForm.username}
                                                    onChange={(e) => setNewUserForm({...newUserForm, username: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder="ç™»å…¥ç”¨å¸³è™Ÿ"
                                                    required
                                                />
                                            </div>

                                            <div>
                                                 <label className="block text-sm md:text-base font-medium mb-1">Firebase å¯†ç¢¼ {!editingUser && '*'}</label>
                                                <input
                                                    type="password"
                                                    value={newUserForm.firebasePassword}
                                                    onChange={(e) => setNewUserForm({...newUserForm, firebasePassword: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder={editingUser ? 'ç·¨è¼¯å“¡å·¥æ™‚ä¸æœƒè®Šæ›´ Firebase å¯†ç¢¼' : 'è‡³å°‘ 6 ç¢¼'}
                                                    required={!editingUser}
                                                />
                                            </div>

                                            <div>
                                               <label className="block text-sm md:text-base font-medium mb-1">å§“å *</label>
                                                <input
                                                    type="text"
                                                    value={newUserForm.name}
                                                    onChange={(e) => setNewUserForm({...newUserForm, name: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    required
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">åœ°å€</label>
                                                <select
                                                    value={newUserForm.region}
                                                    onChange={(e) => setNewUserForm({...newUserForm, region: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                >
                                                    {regionOptions.map(region => (
                                                        <option key={region}>{region}</option>
                                                    ))}
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">éƒ¨é–€</label>
                                                <select
                                                    value={newUserForm.department}
                                                    onChange={(e) => setNewUserForm({...newUserForm, department: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                >
                                                     {departmentOptions.map(department => (
                                                        <option key={department}>{department}</option>
                                                    ))}
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">è·ç¨±</label>
                                                <input
                                                    type="text"
                                                    value={newUserForm.position}
                                                    onChange={(e) => setNewUserForm({...newUserForm, position: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">Email</label>
                                                <input
                                                    type="email"
                                                    value={newUserForm.email}
                                                    onChange={(e) => setNewUserForm({...newUserForm, email: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">é›»è©±</label>
                                                <input
                                                    type="tel"
                                                    value={newUserForm.phone}
                                                    onChange={(e) => setNewUserForm({...newUserForm, phone: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder="0912-345-678"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">ç”Ÿæ—¥ (æœˆ/æ—¥)</label>
                                                <input
                                                    type="text"
                                                    value={newUserForm.birthday}
                                                    onChange={(e) => setNewUserForm({...newUserForm, birthday: e.target.value})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    placeholder="ä¾‹å¦‚: 05/15 "
                                                />
                                                <p className="text-xs text-gray-500 mt-1">æ ¼å¼: æœˆ/æ—¥ (ä¸éœ€è¦è¼¸å…¥å¹´ä»½)</p>
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">ç­åˆ¥</label>
                                                <div className="flex space-x-4 mt-2">
                                                    <label className="flex items-center space-x-2">
                                                        <input
                                                            type="checkbox"
                                                            checked={newUserForm.shift.includes('æ—©')}
                                                            onChange={() => toggleShift('æ—©')}
                                                            className="w-4 h-4"
                                                        />
                                                        <span>æ—©ç­</span>
                                                    </label>
                                                    <label className="flex items-center space-x-2">
                                                        <input
                                                            type="checkbox"
                                                            checked={newUserForm.shift.includes('æ™š')}
                                                            onChange={() => toggleShift('æ™š')}
                                                            className="w-4 h-4"
                                                        />
                                                        <span>æ™šç­</span>
                                                    </label>
                                                </div>
                                            </div>

                                            <div>
                                                <label className="block text-sm md:text-base font-medium mb-1">å¹´åº¦ç‰¹ä¼‘å¤©æ•¸</label>
                                                <input
                                                    type="number"
                                                    value={newUserForm.annualLeave}
                                                    onChange={(e) => setNewUserForm({...newUserForm, annualLeave: parseInt(e.target.value) || 0})}
                                                    className="w-full px-3 py-2 border rounded-lg"
                                                    min="0"
                                                    max="30"
                                                />
                                            </div>

                                            <div className="md:col-span-2">
                                                <label className="flex items-center space-x-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={newUserForm.isAdmin}
                                                        onChange={(e) => setNewUserForm({...newUserForm, isAdmin: e.target.checked})}
                                                        className="w-4 h-4"
                                                    />
                                                     <span className="text-sm md:text-base font-medium">è¨­ç‚ºç®¡ç†å“¡</span>
                                                    <span className="text-xs text-gray-500">(ç®¡ç†å“¡å¯ä»¥ç®¡ç†æ‰€æœ‰å“¡å·¥å’Œå¯©æ ¸è«‹å‡)</span>
                                                </label>
                                            </div>

                                           {newUserForm.isAdmin && (
                                                <div className="md:col-span-2 rounded-lg border border-indigo-100 bg-indigo-50 p-4">
                                                    <div className="flex items-center justify-between">
                                                        <h4 className="text-sm md:text-base font-semibold text-indigo-700">æ¬Šé™ç®¡ç†</h4>
                                                        <span className="text-xs text-gray-500">åƒ…å‹¾é¸çš„åœ°å€/éƒ¨é–€å¯å¯©æ ¸æˆ–ç·¨è¼¯å“¡å·¥è³‡æ–™</span>
                                                    </div>
                                                     <div className="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <div>
                                                            <p className="text-sm md:text-base font-medium text-gray-700 mb-2">åœ°å€</p>
                                                            <div className="space-y-2">
                                                                {regionOptions.map(region => (
                                                                    <label key={region} className="flex items-center space-x-2 text-sm md:text-base">
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={newUserForm.permissionRegions.includes(region)}
                                                                            onChange={() => togglePermission('region', region)}
                                                                            className="w-4 h-4"
                                                                        />
                                                                        <span>{region}</span>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <p className="text-sm md:text-base font-medium text-gray-700 mb-2">éƒ¨é–€</p>
                                                            <div className="space-y-2">
                                                                {departmentOptions.map(department => (
                                                                    <label key={department} className="flex items-center space-x-2 text-sm md:text-base">
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={newUserForm.permissionDepartments.includes(department)}
                                                                            onChange={() => togglePermission('department', department)}
                                                                            className="w-4 h-4"
                                                                        />
                                                                        <span>{department}</span>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                           )}

                                            <div className="md:col-span-2 flex space-x-2">
                                               <button
                                                    type="submit"
                                                    className="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700"
                                                >
                                                    {editingUser ? 'æ›´æ–°å“¡å·¥' : 'ç¢ºèªæ–°å¢'}
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => {
                                                        setShowAddUser(false);
                                                        setEditingUser(null);
                                                        setNewUserForm({
                    id: '',
                    username: '',
                    firebasePassword: '',
                                                            name: '',
                                                            region: regionOptions[0],
                                                            department: departmentOptions[0],
                                                            position: 'å°ˆå“¡',
                                                            email: '',
                                                            phone: '',
                                                            birthday: '',
                                                            shift: [],
                                                            annualLeave: 10,
                                                            isAdmin: false,
                                                            permissionRegions: [...regionOptions],
                                                            permissionDepartments: [...departmentOptions]
                                                        });
                                                    }}
                                                    className="px-6 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300"
                                                >
                                                    å–æ¶ˆ
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                )}

                                <div className="bg-white rounded-lg shadow overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-4 py-3 text-left text-xs">å“¡å·¥ä»£è™Ÿ</th>
                                                <th className="px-4 py-3 text-left text-xs">å§“å</th>
                                                <th className="px-4 py-3 text-left text-xs">åœ°å€</th>
                                                <th className="px-4 py-3 text-left text-xs">éƒ¨é–€</th>
                                                <th className="px-4 py-3 text-left text-xs">è·ç¨±</th>
                                                <th className="px-4 py-3 text-left text-xs">Email</th>
                                                <th className="px-4 py-3 text-left text-xs">é›»è©±</th>
                                                <th className="px-4 py-3 text-left text-xs">ç­åˆ¥</th>
                                                <th className="px-4 py-3 text-left text-xs">æ“ä½œ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.users.map(user => {
                                                const canManage = canManageUser(user);
                                                return (
                                                    <tr key={user.id}>
                                                        <td className="px-4 py-3">{user.id}</td>
                                                        <td className="px-4 py-3">{user.name}</td>
                                                        <td className="px-4 py-3">{user.region}</td>
                                                        <td className="px-4 py-3">{user.department}</td>
                                                        <td className="px-4 py-3">{user.position}</td>
                                                        <td className="px-4 py-3">{user.email}</td>
                                                        <td className="px-4 py-3">{user.phone}</td>
                                                        <td className="px-4 py-3">
                                                            <div className="flex space-x-1">
                                                                {user.shift.includes('æ—©') && (
                                                                    <span className="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">æ—©</span>
                                                                )}
                                                                {user.shift.includes('æ™š') && (
                                                                    <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">æ™š</span>
                                                                )}
                                                            </div>
                                                        </td>
                                                        <td className="px-4 py-3">
                                                            <div className="flex space-x-2">
                                                                <button
                                                                    onClick={() => canManage && handleEditUser(user)}
                                                                    className={`text-blue-600 ${canManage ? 'hover:text-blue-800' : 'opacity-40 cursor-not-allowed'}`}
                                                                    title={canManage ? 'ç·¨è¼¯' : 'ç„¡æ¬Šé™ç·¨è¼¯æ­¤å“¡å·¥'}
                                                                    disabled={!canManage}
                                                                >
                                                                    <Edit2 size={16} />
                                                                </button>
                                                                <button
                                                                    onClick={() => canManage && handleDeleteUser(user.id)}
                                                                    className={`text-red-600 ${canManage ? 'hover:text-red-800' : 'opacity-40 cursor-not-allowed'}`}
                                                                    title={canManage ? 'åˆªé™¤' : 'ç„¡æ¬Šé™åˆªé™¤æ­¤å“¡å·¥'}
                                                                    disabled={!canManage}
                                                                >
                                                                    <Trash2 size={16} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>

                                <div className="bg-white rounded-lg shadow p-4">
                                    <h3 className="text-lg font-bold mb-4">æ“ä½œç´€éŒ„</h3>
                                    <div className="space-y-2 max-h-64 overflow-y-auto">
                                        {data.auditLogs.slice(-10).reverse().map((log, idx) => (
                                            <div key={idx} className="text-sm md:text-base p-2 bg-gray-50 rounded">
                                                <span className="text-gray-500">{new Date(log.timestamp).toLocaleString('zh-TW')}</span>
                                                {' - '}
                                                <span className="font-medium">{log.user}</span>
                                                {' '}
                                                <span className="text-indigo-600">{log.action}</span>
                                                {' - '}
                                                <span>{log.details}</span>
                                            </div>
                                        ))}
                                        {data.auditLogs.length === 0 && (
                                            <p className="text-center text-gray-500 py-4">ç›®å‰æ²’æœ‰æ“ä½œç´€éŒ„</p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'vacation' && (
                            <div className="space-y-4">
                                {/* å¯ä¼‘å¤©æ•¸é¡¯ç¤º */}
                                  <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-lg p-4 text-white">
                                    <div>
                                        <h3 className="text-base opacity-90">æˆ‘çš„å¯ä¼‘å¤©æ•¸</h3>
                                        <p className="text-3xl font-bold mt-1">{currentUser.annualLeave - (data.leaves.filter(l => l.userId === currentUser.id && l.type === 'ç‰¹ä¼‘' && l.status === 'å·²æ ¸å‡†').length)} å¤©</p>
                                        <p className="text-xs opacity-80 mt-1">å·²ä½¿ç”¨: {data.leaves.filter(l => l.userId === currentUser.id && l.type === 'ç‰¹ä¼‘' && l.status === 'å·²æ ¸å‡†').length} å¤©</p>
                                    </div>
                                </div>

                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">ä¼‘å‡è¡¨</h2>
                                    <div className="flex space-x-2">
                                        <select
                                            value={filterRegion}
                                            onChange={(e) => setFilterRegion(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>åœ°å€</option>
                                            <option>æ–°ç«¹å€</option>
                                            <option>å°ä¸­å€</option>
                                            <option>å˜‰ç¾©å€</option>
                                        </select>
                                        <select
                                            value={filterDepartment}
                                            onChange={(e) => setFilterDepartment(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>éƒ¨é–€</option>
                                            <option>ç®¡ç†éƒ¨</option>
                                            <option>TSE</option>
                                            <option>FAE</option>
                                            <option>æ–°å ´</option>
                                            <option>å€‰ç®¡</option>
                                            <option>RD</option>
                                            <option>ç·šä¸Šå®¢æœ</option>
                                        </select>
                                        <select
                                            value={filterShift}
                                            onChange={(e) => setFilterShift(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>ç­åˆ¥</option>
                                            <option>æ—©</option>
                                            <option>æ™š</option>
                                        </select>
                                        <button
                                            onClick={() => exportToCSV('vacation')}
                                            className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                        >
                                            <Download size={18} />
                                            <span>åŒ¯å‡ºExcel</span>
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-lg shadow p-4">
                                             {currentUser.isAdmin && (
                                        <div className="mb-4 rounded-lg border border-indigo-100 bg-indigo-50 p-3">
                                            <p className="text-sm md:text-base font-medium text-indigo-700 mb-2">ç­è¡¨é–‹æ”¾æ—¥æœŸè¨­å®š (ç®¡ç†å“¡)</p>
                                            <div className="flex flex-wrap gap-3 items-center">
                                                <div className="flex items-center space-x-2">
                                                   <label className="text-sm md:text-base text-gray-700">é–‹å§‹</label>
                                                    <input
                                                        type="date"
                                                        value={data.vacationSettings.openStart}
                                                        onChange={(e) => handleVacationSettingChange('openStart', e.target.value)}
                                                        className="px-3 py-2 border rounded-lg"
                                                    />
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                     <label className="text-sm md:text-base text-gray-700">çµæŸ</label>
                                                    <input
                                                        type="date"
                                                        value={data.vacationSettings.openEnd}
                                                        onChange={(e) => handleVacationSettingChange('openEnd', e.target.value)}
                                                        className="px-3 py-2 border rounded-lg"
                                                    />
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <label className="text-sm md:text-base text-gray-700">æœ¬æœˆå¯ä¼‘å¤©æ•¸</label>
                                                    <input
                                                        type="number"
                                                        min="0"
                                                        value={data.vacationSettings.monthlyVacationDays}
                                                        onChange={(e) => handleVacationSettingChange('monthlyVacationDays', e.target.value)}
                                                        className="w-24 px-3 py-2 border rounded-lg"
                                                    />
                                                    <span className="text-sm md:text-base text-gray-600">å¤©</span>
                                                </div>
                                                <span className="text-xs text-gray-600">
                                                    é–‹æ”¾æœŸé–“å…§å“¡å·¥å¯è‡ªè¡Œç·¨è¼¯ä¼‘å‡æ—¥
                                                </span>
                                            </div>
                                        </div>
                                    )}
                                    <div className="mb-4 flex flex-wrap items-center gap-3 text-sm md:text-base text-gray-600">
                                        <div className="flex flex-wrap items-center gap-2">
                                            <span className="font-medium text-gray-700">ä¼‘å‡ç¬¦è™Ÿ:</span>
                                           {vacationMarkerOptions.map(option => (
                                                <button
                                                    key={option.value}
                                                    onClick={() => setSelectedVacationMarker(option.value)}
                                                    className={`px-2 py-1 rounded border ${selectedVacationMarker === option.value ? option.activeClass : 'border-gray-200'}`}
                                                >
                                                    <span className={`${option.textClass} font-bold`}>{option.symbol}</span> {option.label.split(' ')[1]}
                                                </button>
                                            ))}
                                        </div>
                                        <div className="text-xs text-gray-500">
                                            {data.vacationSettings.openStart && data.vacationSettings.openEnd
                                                ? `é–‹æ”¾æœŸé–“: ${data.vacationSettings.openStart} ~ ${data.vacationSettings.openEnd}`
                                                : 'å°šæœªè¨­å®šé–‹æ”¾æ—¥æœŸ'}
                                        </div>
                                          <div className="text-sm md:text-base text-gray-600">
                                            æœ¬æœˆå¯ä¼‘: {data.vacationSettings.monthlyVacationDays || 'æœªè¨­å®š'} å¤©
                                        </div>
                                    </div>
                                    <div className="flex justify-between mb-4">
                                        <button onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() - 1))} className="px-4 py-2 bg-gray-100 rounded">
                                            ä¸Šå€‹æœˆ
                                        </button>
                                        <h3 className="text-xl font-bold">
                                            {selectedMonth.getFullYear()}å¹´ {selectedMonth.getMonth() + 1}æœˆ
                                        </h3>
                                        <button onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() + 1))} className="px-4 py-2 bg-gray-100 rounded">
                                            ä¸‹å€‹æœˆ
                                        </button>
                                    </div>

                                    <div>
                                        <table className="w-full border-collapse text-sm md:text-base table-fixed">
                                            <thead>
                                                <tr>
                                                   <th className="border-2 border-gray-400 p-2 bg-gray-100 sticky left-0 z-20 w-28 text-sm md:text-base">æ˜ŸæœŸ</th>
                                                    {getMonthDays(selectedMonth).map(day => {
                                                        const holiday = isHoliday(day);
                                                        const weekend = isWeekend(day);
                                                        const dayName = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][day.getDay()];
                                                        return (
                                                            <th
                                                                key={`week-${day.toISOString()}`}
                                                                className={`border-2 p-1 text-center text-sm md:text-base font-bold ${
                                                                    holiday ? 'bg-red-200 text-red-900 border-red-400' :
                                                                    weekend ? 'bg-blue-200 text-blue-900 border-blue-400' :
                                                                    'bg-gray-50 border-gray-300'
                                                                }`}
                                                            >
                                                                {dayName}
                                                            </th>
                                                        );
                                                    })}
                                                  <th className="border-2 border-gray-400 p-2 bg-yellow-100 font-bold sticky right-0 z-20 w-24 whitespace-nowrap text-sm md:text-base">å·²é¸å¤©æ•¸</th>
                                                </tr>
                                                <tr>
                                                    <th className="border-2 border-gray-400 p-2 bg-gray-100 sticky left-0 z-20 text-sm md:text-base">æ—¥æœŸ</th>
                                                    {getMonthDays(selectedMonth).map(day => {
                                                        const holiday = isHoliday(day);
                                                        const weekend = isWeekend(day);
                                                        return (
                                                            <th
                                                                key={`date-${day.toISOString()}`}
                                                                 className={`border-2 p-1 text-center text-sm md:text-base font-bold ${
                                                                    holiday ? 'bg-red-200 text-red-900 border-red-400' :
                                                                    weekend ? 'bg-blue-200 text-blue-900 border-blue-400' :
                                                                    'bg-gray-50 border-gray-300'
                                                                }`}
                                                            >
                                                                {day.getDate()}
                                                            </th>
                                                        );
                                                    })}
                                                    <th className="border-2 border-gray-400 p-2 bg-yellow-100 sticky right-0 z-20"></th>
                                                </tr>
                                                <tr>
                                                 <th className="border-2 border-gray-400 p-2 bg-gray-100 sticky left-0 z-20 text-sm md:text-base">åœ‹å®šå‡æ—¥</th>
                                                    {getMonthDays(selectedMonth).map(day => {
                                                        const holiday = isHoliday(day);
                                                        const weekend = isWeekend(day);
                                                        return (
                                                            <th
                                                                key={`note-${day.toISOString()}`}
                                                               className={`border-2 p-1 text-center text-sm md:text-base ${
                                                                    holiday ? 'bg-red-200 text-red-900 border-red-400' :
                                                                    weekend ? 'bg-blue-200 text-blue-900 border-blue-400' :
                                                                    'bg-gray-50 border-gray-300'
                                                                }`}
                                                            >
                                                                {holiday ? holiday.name : ''}
                                                            </th>
                                                        );
                                                    })}
                                                    <th className="border-2 border-gray-400 p-2 bg-yellow-100 sticky right-0 z-20"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.users
                                                    .filter(u =>
                                                        (filterRegion === 'å…¨éƒ¨' || u.region === filterRegion) &&
                                                        (filterDepartment === 'å…¨éƒ¨' || u.department === filterDepartment) &&
                                                        (filterShift === 'å…¨éƒ¨' || u.shift.includes(filterShift))
                                                    )
                                                    .map(user => {
                                                       const userLeaves = data.leaves.filter(l =>
                                                            l.userId === user.id &&
                                                            l.status === 'å·²æ ¸å‡†' &&
                                                            parseDateString(l.startDate)?.getMonth() === selectedMonth.getMonth()
                                                        );
                                                        const isCurrentUser = user.id === currentUser.id;
                                                        const markerCount = (data.vacationSchedule[user.id] && Object.values(data.vacationSchedule[user.id]).filter(Boolean).length) || 0;

                                                        return (
                                                            <tr key={user.id} className={isCurrentUser ? 'bg-indigo-50' : ''}>
                                                                <td className="border-2 border-gray-400 p-2 font-medium bg-white sticky left-0 z-10">
                                                                    <div>
                                                                        {user.name}
                                                                        {isCurrentUser && <span className="ml-1 text-xs bg-indigo-600 text-white px-2 py-0.5 rounded">æˆ‘</span>}
                                                                    </div>
                                                                    <div className="text-xs text-gray-500">{user.department}</div>
                                                                    <div className="flex gap-1 mt-1">
                                                                        {user.shift.includes('æ—©') && (
                                                                            <span className="px-1 py-0.5 bg-yellow-100 text-yellow-800 text-xs rounded">æ—©</span>
                                                                        )}
                                                                        {user.shift.includes('æ™š') && (
                                                                            <span className="px-1 py-0.5 bg-blue-100 text-blue-800 text-xs rounded">æ™š</span>
                                                                        )}
                                                                    </div>
                                                                </td>
                                                                {getMonthDays(selectedMonth).map(day => {
                                                                    const dateStr = formatLocalDate(day);
                                                                    const leave = userLeaves.find(l =>
                                                                        dateStr >= l.startDate && dateStr <= l.endDate
                                                                    );
                                                                    const holiday = isHoliday(day);
                                                                    const weekend = isWeekend(day);
                                                                    const customMarker = data.vacationSchedule[user.id]?.[dateStr];
                                                                    const isOpen = isWithinOpenRange(day);
                                                                    const isEditable = isOpen && isCurrentUser;
                                                                    const markerDisplay = getMarkerDisplay(customMarker);

                                                                    return (
                                                                        <td
                                                                            key={day.toISOString()}
                                                                             className={`border p-1 text-center ${
                                                                                leave ? 'bg-orange-100 text-orange-900 font-bold border-orange-300' :
                                                                                holiday ? 'bg-red-50 border-red-200' :
                                                                                weekend ? 'bg-blue-50 border-blue-200' :
                                                                                     'border-gray-200'
                                                                            } ${isEditable ? 'cursor-pointer hover:bg-indigo-50' : ''}`}
                                                                            onClick={() => handleToggleVacation(user.id, dateStr)}
                                                                            title={isEditable ? 'é»æ“Šè¨­å®šä¼‘å‡æ¨™è¨˜' : ''}
                                                                        >
                                                                                                                      {leave ? (
                                                                                <span className="text-purple-700 font-semibold">è«‹</span>
                                                                            ) : markerDisplay ? (
                                                                                <span className={markerDisplay.className}>
                                                                                    {markerDisplay.symbol}
                                                                                </span>
                                                                            ) : ''}
                                                                        </td>
                                                                    );
                                                                })}
                                                                <td className="border-2 border-gray-400 p-2 text-center font-bold text-base text-indigo-700 bg-yellow-50 sticky right-0 z-10 w-24 whitespace-nowrap">
                                                                    {markerCount}
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                <tr className="bg-green-50">
                                                    <td className="border-2 border-gray-400 p-2 font-bold text-center sticky left-0 z-10 bg-green-100">ä¸Šç­äººæ•¸</td>
                                                    {getMonthDays(selectedMonth).map(day => {
                                                        return (
                                                            <td
                                                                key={`count-${day.toISOString()}`}
                                                                className="border-2 border-gray-300 p-2 text-center font-bold text-green-700 bg-green-50"
                                                            >
                                                                {getWorkingCount(day)}
                                                                </td>
                                                );
                                            })}
                                                    <td className="border-2 border-gray-400 p-2 sticky right-0 z-10 bg-green-100"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
 
                                    <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                                         <h4 className="font-bold mb-2 text-sm md:text-base">åœ–ä¾‹èªªæ˜:</h4>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                                            <div className="flex items-center space-x-2">
                                                <div className="w-4 h-4 bg-red-200 border-2 border-red-400"></div>
                                                <span>åœ‹å®šå‡æ—¥</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <div className="w-4 h-4 bg-blue-200 border-2 border-blue-400"></div>
                                                <span>é€±æœ«</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <div className="w-4 h-4 bg-orange-100 border-2 border-orange-300"></div>
                                                 <span>å·²æ ¸å‡†è«‹å‡</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <div className="w-4 h-4 bg-indigo-50 border-2"></div>
                                                <span>æˆ‘çš„è³‡æ–™</span>
                                            </div>
                                        </div>
                                       <p className="text-xs text-gray-600 mt-2">ğŸ’¡ é–‹æ”¾æœŸé–“å…§å¯é»æ“Šè‡ªå·±çš„æ—¥æœŸè¨­å®šâ–²/â˜…ï¼ˆé»‘æˆ–ç´…ï¼‰</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'leave' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">è«‹å‡ç”³è«‹</h2>
                                    <button
                                        onClick={() => exportToCSV('leaves')}
                                        className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                    >
                                        <Download size={18} />
                                        <span>åŒ¯å‡ºExcel</span>
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h3 className="text-lg font-bold mb-4">æ–°å¢è«‹å‡</h3>
                                        <form onSubmit={handleSubmitLeave} className="space-y-4">
                                            <input type="text" value={currentUser.name} disabled className="w-full px-3 py-2 border rounded bg-gray-50" />

                                            <select value={newLeaveForm.type} onChange={(e) => setNewLeaveForm({...newLeaveForm, type: e.target.value})} className="w-full px-3 py-2 border rounded">
                                                <option>ç‰¹ä¼‘</option>
                                                <option>ç—…å‡</option>
                                                <option>äº‹å‡</option>
                                                <option>æ—…éŠå‡</option>
                                                <option>å–ªå‡</option>
                                                <option>ç”Ÿç†å‡</option>
                                                <option>è£œä¼‘(æ™‚)</option>
                                                <option>è£œä¼‘(å¤©)</option>
                                                <option>å¹´å‡</option>
                                            </select>

                                            <input type="date" value={newLeaveForm.startDate} onChange={(e) => setNewLeaveForm({...newLeaveForm, startDate: e.target.value})} className="w-full px-3 py-2 border rounded" required />

                                            <input type="date" value={newLeaveForm.endDate} onChange={(e) => setNewLeaveForm({...newLeaveForm, endDate: e.target.value})} className="w-full px-3 py-2 border rounded" required />

                                            <textarea value={newLeaveForm.reason} onChange={(e) => setNewLeaveForm({...newLeaveForm, reason: e.target.value})} className="w-full px-3 py-2 border rounded" rows="3" required />

                                            <button type="submit" className="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">
                                                é€å‡ºç”³è«‹
                                            </button>
                                        </form>
                                    </div>

                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h3 className="text-lg font-bold mb-4">æˆ‘çš„ç”³è«‹</h3>
                                        <div className="space-y-3">
                                            {data.leaves.filter(l => l.userId === currentUser.id).map(leave => (
                                                <div key={leave.id} className="border rounded p-3">
                                                    <div className="flex justify-between mb-2">
                                                        <span className="font-medium">{leave.type}</span>
                                                        <span className={`px-2 py-1 text-xs rounded ${leave.status === 'å·²æ ¸å‡†' ? 'bg-green-100' : 'bg-yellow-100'}`}>
                                                            {leave.status}
                                                        </span>
                                                    </div>
                                                     <p className="text-sm md:text-base">{leave.startDate} ~ {leave.endDate}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {currentUser.isAdmin && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h3 className="text-lg font-bold mb-4">å¾…å¯©æ ¸ (ç®¡ç†å“¡)</h3>
                                          <p className="text-xs text-gray-500 mb-3">åƒ…å¯å¯©æ ¸å…·æ¬Šé™çš„åœ°å€æˆ–éƒ¨é–€</p>
                                       {approvablePendingLeaves.map(leave => {
                                            return (
                                                <div key={leave.id} className="border rounded p-4 mb-3">
                                                    <div className="flex justify-between">
                                                        <div>
                                                            <p className="font-medium">{leave.userName} - {leave.type}</p>
                                                            <p className="text-sm md:text-base">{leave.startDate} ~ {leave.endDate}</p>
                                                            <p className="text-xs text-gray-500">{leave.region} / {leave.department}</p>
                                                        </div>
                                                        <div className="flex space-x-2">
                                                            <button
                                                               onClick={() => handleApproveLeave(leave.id, 'å·²æ ¸å‡†')}
                                                                className="px-3 py-1 rounded text-white bg-green-600"
                                                            >
                                                                æ ¸å‡†
                                                            </button>
                                                            <button
                                                               onClick={() => handleApproveLeave(leave.id, 'å·²æ‹’çµ•')}
                                                                className="px-3 py-1 rounded text-white bg-red-600"
                                                            >
                                                                æ‹’çµ•
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                             );
                                        })}
                                       {approvablePendingLeaves.length === 0 && (
                                            <p className="text-center text-gray-500 py-4">ç›®å‰æ²’æœ‰å¾…å¯©æ ¸ç”³è«‹</p>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'annual' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">ç‰¹ä¼‘ç¸½è¦½</h2>
                                    <div className="flex space-x-2">
                                        <select
                                            value={filterRegion}
                                            onChange={(e) => setFilterRegion(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>å…¨éƒ¨</option>
                                            <option>æ–°ç«¹å€</option>
                                            <option>å°ä¸­å€</option>
                                            <option>å˜‰ç¾©å€</option>
                                        </select>
                                        <select
                                            value={filterDepartment}
                                            onChange={(e) => setFilterDepartment(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>å…¨éƒ¨</option>
                                            <option>ç®¡ç†éƒ¨</option>
                                            <option>TSE</option>
                                            <option>FAE</option>
                                            <option>æ–°å ´</option>
                                            <option>å€‰ç®¡</option>
                                            <option>RD</option>
                                            <option>ç·šä¸Šå®¢æœ</option>
                                        </select>
                                         <select
                                            value={filterShift}
                                            onChange={(e) => setFilterShift(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>å…¨éƒ¨</option>
                                            <option>æ—©</option>
                                            <option>æ™š</option>
                                        </select>
                                        <button
                                            onClick={() => exportToCSV('annual')}
                                            className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                        >
                                            <Download size={18} />
                                            <span>åŒ¯å‡ºExcel</span>
                                        </button>
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg shadow overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-4 py-3 text-left">å“¡å·¥</th>
                                                <th className="px-4 py-3 text-left">åœ°å€</th>
                                                <th className="px-4 py-3 text-left">éƒ¨é–€</th>
                                                <th className="px-4 py-3 text-left">ç­åˆ¥</th>
                                                <th className="px-4 py-3 text-left">ç¸½ç‰¹ä¼‘</th>
                                                <th className="px-4 py-3 text-left">å·²ä½¿ç”¨</th>
                                                <th className="px-4 py-3 text-left">å‰©é¤˜</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.users.filter(user =>
                                                (filterRegion === 'å…¨éƒ¨' || user.region === filterRegion) &&
                                                (filterDepartment === 'å…¨éƒ¨' || user.department === filterDepartment) &&
                                                (filterShift === 'å…¨éƒ¨' || user.shift.includes(filterShift))
                                            ).map(user => {
                                                const used = data.leaves.filter(l => l.userId === user.id && l.type === 'ç‰¹ä¼‘' && l.status === 'å·²æ ¸å‡†').length;
                                                return (
                                                    <tr key={user.id}>
                                                         <td className="px-4 py-3">
                                                            <button
                                                                type="button"
                                                                onClick={() => setSelectedAnnualUserId(user.id)}
                                                                className="text-blue-600 hover:text-blue-800 hover:underline"
                                                            >
                                                                {user.name}
                                                            </button>
                                                        </td>
                                                        <td className="px-4 py-3">{user.region}</td>
                                                        <td className="px-4 py-3">{user.department}</td>
                                                        <td className="px-4 py-3">{user.shift.join('/')}</td>
                                                        <td className="px-4 py-3">{user.annualLeave} å¤©</td>
                                                        <td className="px-4 py-3">{used} å¤©</td>
                                                        <td className="px-4 py-3">
                                                            <span className="px-2 py-1 bg-green-100 rounded">{user.annualLeave - used} å¤©</span>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>

                                {selectedAnnualUserId && (() => {
                                    const selectedUser = data.users.find(user => user.id === selectedAnnualUserId);
                                    if (!selectedUser) return null;

                                    const approvedAnnualLeaves = data.leaves.filter(
                                        leave => leave.userId === selectedAnnualUserId && leave.type === 'ç‰¹ä¼‘' && leave.status === 'å·²æ ¸å‡†'
                                    );
                                    const uniqueLeaveDates = [
                                        ...new Set(
                                            approvedAnnualLeaves.flatMap(leave => getDateRangeList(leave.startDate, leave.endDate))
                                        )
                                    ].sort();

                                    return (
                                        <div className="bg-white rounded-lg shadow p-6 space-y-3">
                                            <div className="flex items-center justify-between">
                                                <h3 className="text-lg font-bold">{selectedUser.name} ç‰¹ä¼‘æ˜ç´°</h3>
                                                <button
                                                    type="button"
                                                    onClick={() => setSelectedAnnualUserId('')}
                                                    className="text-sm text-gray-500 hover:text-gray-700"
                                                >
                                                    é—œé–‰
                                                </button>
                                            </div>
                                            <p className="text-sm text-gray-600">æ ¸å‡†ç‰¹ä¼‘ç­†æ•¸ï¼š{approvedAnnualLeaves.length} ç­†</p>

                                            {approvedAnnualLeaves.length === 0 ? (
                                                <p className="text-gray-500">ç›®å‰å°šç„¡å·²æ ¸å‡†çš„ç‰¹ä¼‘ç´€éŒ„ã€‚</p>
                                            ) : (
                                                <>
                                                    <div className="space-y-2">
                                                        {approvedAnnualLeaves.map(leave => (
                                                            <div key={leave.id} className="p-3 border rounded bg-gray-50 text-sm">
                                                                <div>{leave.startDate} ~ {leave.endDate}</div>
                                                                <div className="text-gray-600">äº‹ç”±ï¼š{leave.reason || 'æœªå¡«å¯«'}</div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                    <div>
                                                        <p className="text-sm font-medium mb-1">ä¼‘å‡æ—¥æœŸ</p>
                                                        <div className="flex flex-wrap gap-2">
                                                            {uniqueLeaveDates.map(date => (
                                                                <span key={date} className="px-2 py-1 text-xs rounded bg-indigo-100 text-indigo-700">{date}</span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    );
                                })()}
                            </div>
                        )}

                        {/* è£œä¼‘è¡¨ */}
                        {activeTab === 'compensatory' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">è£œä¼‘è¡¨</h2>
                                    <div className="flex space-x-2">
                                        <select
                                            value={filterRegion}
                                            onChange={(e) => setFilterRegion(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>å…¨éƒ¨</option>
                                            <option>æ–°ç«¹å€</option>
                                            <option>å°ä¸­å€</option>
                                            <option>å˜‰ç¾©å€</option>
                                        </select>
                                        <select
                                            value={filterDepartment}
                                            onChange={(e) => setFilterDepartment(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>å…¨éƒ¨</option>
                                            <option>ç®¡ç†éƒ¨</option>
                                            <option>TSE</option>
                                            <option>FAE</option>
                                            <option>æ–°å ´</option>
                                            <option>å€‰ç®¡</option>
                                            <option>RD</option>
                                            <option>ç·šä¸Šå®¢æœ</option>
                                            </select>
                                        <select
                                            value={filterShift}
                                            onChange={(e) => setFilterShift(e.target.value)}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option>å…¨éƒ¨</option>
                                            <option>æ—©</option>
                                            <option>æ™š</option>
                                        </select>
                                        <button
                                            onClick={() => exportToCSV('compensatory')}
                                            className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                        >
                                            <Download size={18} />
                                            <span>åŒ¯å‡ºExcel</span>
                                        </button>
                                    </div>
                                </div>

                              <div className="bg-white rounded-lg shadow p-4">
                                    <div className="flex items-center justify-between mb-4">
                                        <button
                                            onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() - 1, 1))}
                                            className="px-3 py-1 border rounded hover:bg-gray-50"
                                        >
                                            ä¸Šæœˆ
                                        </button>
                                        <h3 className="text-lg font-semibold">{selectedMonth.getFullYear()} å¹´ {selectedMonth.getMonth() + 1} æœˆè£œä¼‘å®‰æ’</h3>
                                        <button
                                            onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() + 1, 1))}
                                            className="px-3 py-1 border rounded hover:bg-gray-50"
                                        >
                                            ä¸‹æœˆ
                                        </button>
                                    </div>

                                    <div className="overflow-x-auto">
                                       <table className="w-full text-sm">
                                            <thead>
                                                <tr>
                                                    <th className="sticky left-0 bg-gray-50 px-4 py-2 border">å“¡å·¥</th>
                                                    <th className="px-4 py-2 border">åœ°å€</th>
                                                    <th className="px-4 py-2 border">éƒ¨é–€</th>
                                                    <th className="px-4 py-2 border">ç­åˆ¥</th>
                                                    {getMonthDays(selectedMonth).map(day => {
                                                        const dateStr = formatLocalDate(day);
                                                        const holiday = holidays2026.find(h => h.date === dateStr);
                                                        const isWeekend = day.getDay() === 0 || day.getDay() === 6;
                                                        return (
                                                            <th
                                                                key={dateStr}
                                                                className={`min-w-[52px] px-2 py-2 border text-center ${holiday ? 'bg-red-50 text-red-600' : isWeekend ? 'bg-blue-50 text-blue-600' : 'bg-gray-50'}`}
                                                            >
                                                                {day.getDate()}
                                                            </th>
                                                        );
                                                    })}
                                                    <th className="px-4 py-2 border bg-gray-50">æœ¬æœˆè£œä¼‘(æ™‚)</th>
                                                    <th className="px-4 py-2 border bg-gray-50">æœ¬æœˆè£œä¼‘(å¤©)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {data.users
                                                    .filter(u =>
                                                        (filterRegion === 'å…¨éƒ¨' || u.region === filterRegion) &&
                                                        (filterDepartment === 'å…¨éƒ¨' || u.department === filterDepartment) &&
                                                        (filterShift === 'å…¨éƒ¨' || u.shift.includes(filterShift))
                                                    )
                                                    .map(user => {
                                                        const currentMonthStats = getCompStats(user.id, selectedMonth);
                                                        return (
                                                            <tr key={user.id} className="hover:bg-gray-50">
                                                                <td className="sticky left-0 bg-white px-4 py-2 border font-medium">{user.name}</td>
                                                                <td className="px-4 py-2 border">{user.region}</td>
                                                                <td className="px-4 py-2 border">{user.department}</td>
                                                                <td className="px-4 py-2 border">{user.shift.join('/')}</td>
                                                                {getMonthDays(selectedMonth).map(day => {
                                                                    const dateStr = formatLocalDate(day);
                                                                    const cell = getCompensatoryCellData(user.id, dateStr);
                                                                    const holiday = holidays2026.find(h => h.date === dateStr);
                                                                    const isWeekend = day.getDay() === 0 || day.getDay() === 6;
                                                                    return (
                                                                        <td
                                                                            key={`${user.id}-${dateStr}`}
                                                                            className={`px-2 py-2 border text-center font-medium ${cell ? 'text-indigo-700 bg-indigo-50' : holiday ? 'bg-red-50' : isWeekend ? 'bg-blue-50' : ''}`}
                                                                        >
                                                                            {cell || '-'}
                                                                        </td>
                                                                    );
                                                                })}
                                                                <td className="px-4 py-2 border text-center">{currentMonthStats.hours} å°æ™‚</td>
                                                                <td className="px-4 py-2 border text-center">{currentMonthStats.days} å¤©</td>
                                                            </tr>
                                                        );
                                                    })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* æ’ç¨‹è¡¨ */}
                        {activeTab === 'schedule' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">æ’ç¨‹è¡¨</h2>
                                    <button
                                        onClick={() => exportToCSV('schedule')}
                                        className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                    >
                                        <Download size={18} />
                                        <span>åŒ¯å‡ºExcel</span>
                                    </button>
                                </div>

                                <div className="bg-white rounded-lg shadow p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <button
                                            onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() - 1))}
                                            className="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200"
                                        >
                                            ä¸Šå€‹æœˆ
                                        </button>
                                        <h3 className="text-xl font-bold">
                                            {selectedMonth.getFullYear()}å¹´ {selectedMonth.getMonth() + 1}æœˆ æ’ç¨‹
                                        </h3>
                                        <button
                                            onClick={() => setSelectedMonth(new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() + 1))}
                                            className="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200"
                                        >
                                            ä¸‹å€‹æœˆ
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-7 gap-2">
                                        {['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].map(day => (
                                            <div key={day} className="text-center font-bold py-2 bg-gray-50 rounded">
                                                {day}
                                            </div>
                                        ))}
                                        
                                        {getMonthDays(selectedMonth).map(day => {
                                            const holiday = isHoliday(day);
                                            const weekend = isWeekend(day);
                                            const dateStr = formatLocalDate(day);
                                            const schedules = data.schedules?.filter(s => s.date === dateStr) || [];

                                            return (
                                                <div
                                                    key={day.toISOString()}
                                                    className={`min-h-24 p-2 border rounded-lg ${
                                                        holiday ? 'bg-red-50' :
                                                        weekend ? 'bg-blue-50' :
                                                        'bg-white'
                                                    } hover:shadow-md cursor-pointer transition-shadow`}
                                                   onClick={() => openScheduleModal(dateStr)}
                                                >
                                                   <div className="font-bold text-sm md:text-base mb-1">
                                                        {day.getDate()}
                                                        {holiday && <span className="ml-1 text-xs text-red-600">{holiday.name}</span>}
                                                    </div>
                                                    <div className="space-y-1">
                                                        {schedules.map(schedule => (
                                                            <div key={schedule.id} className="text-xs bg-indigo-100 text-indigo-800 p-1 rounded">
                                                                <div className="flex items-start justify-between gap-1">
                                                                    <div className="font-medium">{schedule.title}</div>
                                                                    <button
                                                                        type="button"
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            handleDeleteSchedule(schedule.id);
                                                                        }}
                                                                        className="text-red-600 hover:text-red-800"
                                                                        title="åˆªé™¤è¡Œç¨‹"
                                                                    >
                                                                        <Trash2 size={14} />
                                                                    </button>
                                                                </div>
                                                                <div className="text-xs">{schedule.content}</div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <p className="text-sm md:text-base text-blue-800">
                                        ğŸ’¡ é»æ“Šæ—¥æœŸå¯ä»¥æ–°å¢æ’ç¨‹ã€‚æ’ç¨‹è³‡æ–™æœƒè‡ªå‹•å„²å­˜ã€‚
                                    </p>
                                </div>

                                {showScheduleModal && (
                                    <div className="fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50">
                                        <div className="bg-white rounded-lg shadow-lg w-full max-w-xl p-6">
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-lg font-bold">æ–°å¢æ’ç¨‹ï¼ˆ{selectedScheduleDate}ï¼‰</h3>
                                                <button
                                                    type="button"
                                                    onClick={() => setShowScheduleModal(false)}
                                                    className="text-gray-500 hover:text-gray-700"
                                                >
                                                    âœ•
                                                </button>
                                            </div>
                                            <form onSubmit={handleScheduleSubmit} className="space-y-3">
                                                <input
                                                    type="text"
                                                    value={scheduleForm.title}
                                                    onChange={(e) => setScheduleForm(prev => ({ ...prev, title: e.target.value }))}
                                                    placeholder="æ¨™é¡Œ"
                                                    className="w-full px-3 py-2 border rounded"
                                                    required
                                                />
                                                <textarea
                                                    value={scheduleForm.content}
                                                    onChange={(e) => setScheduleForm(prev => ({ ...prev, content: e.target.value }))}
                                                    placeholder="å…§å®¹"
                                                    className="w-full px-3 py-2 border rounded"
                                                    rows="4"
                                                    required
                                                />
                                                <div className="flex justify-end gap-2 pt-2">
                                                    <button
                                                        type="button"
                                                        onClick={() => setShowScheduleModal(false)}
                                                        className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
                                                    >
                                                        å–æ¶ˆ
                                                    </button>
                                                    <button
                                                        type="submit"
                                                        className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700"
                                                    >
                                                        å„²å­˜
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EmployeeLeaveSystem />);
    </script>
</body>
</html>
